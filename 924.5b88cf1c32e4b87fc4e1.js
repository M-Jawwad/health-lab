"use strict";(self.webpackChunkprism_health_lab=self.webpackChunkprism_health_lab||[]).push([[924],{924:(ne,f,r)=>{r.r(f),r.d(f,{ConsumerModule:()=>te});var d=r(8583),m=r(665),A=r(5566),g=r(3633),y=r(4272),O=r(3522),D=r(5651),M=r(9788),I=r(5297),P=r(4330),h=r(409),v=r(8307),w=r(7709),C=r(945),S=r(9522),_=r(799),q=r(2801),l=r(2340);class b{}b.config={title:"Consumer",slug:`${l.N.customerms}/consumer/?`,addBtnText:"Add New Consumer",showHeader:!0,showAdd:!0,showRowActions:!0,doApiCall:!0,searchOptions:[{title:"Consumer Name",column:"consumer_name"},{title:"Email",column:"email"},{title:"Phone Number",column:"phone"},{title:"Status",column:"status"}],rowActions:[{icon:"ri-pencil-line",type:"icon",tooltip:"Edit",action:"onEdit"},{icon:"ri-add-circle-line",type:"icon",tooltip:"Allocate Device",action:"onAllocateDevices"},{icon:"ri-settings-2-line",type:"icon",tooltip:"Change status",action:"onChangeStatus"}],acColumnWidth:"134px",columns:[{name:"id",title:"id",visible:!1},{name:"consumer_name",title:"Consumer Name",sortable:!0,clickable:!0,action:"onDetails"},{name:"first_name",title:"First Name",visible:!1},{name:"last_name",title:"Last Name",visible:!1},{name:"email",title:"Email",sortable:!0},{name:"phone",title:"Phone Number",sortable:!0},{name:"qid_passport",title:"Q-ID / Passport",sortable:!0},{name:"all_devices",title:"Total Devices",sortable:!0,sortableFromView:!0,clickable:!0,action:"onTotalDevices"},{name:"status",title:"status",format:"consumer-status",sortable:!0}]};const U=(o,c,t)=>function(o,c,t){return c[t.name]&&1===c[t.name]?"<span>Active</span>":"<span>InActive</span>"}(0,c,t);var F=r(5931),x=r(4458),J=r(7050),L=r(8366),e=r(7716),Z=r(5830),T=r(9344),u=r(1819);function Y(o,c){1&o&&e._UZ(0,"img",11)}function E(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",12),e.TgZ(1,"button",13),e.NdJ("click",function(){return e.CHM(t),e.oxw().onDeviceAllocation()}),e._UZ(2,"i",14),e.TgZ(3,"span"),e._uU(4,"Allocate Device"),e.qZA(),e.qZA(),e.qZA()}}function k(o,c){1&o&&(e.TgZ(0,"td"),e._uU(1,"Deallocate"),e.qZA())}function B(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"td",18),e.TgZ(1,"button",19),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit;return e.oxw(2).onDeallocateDevice(s)}),e._uU(2,"DeAllocate"),e.qZA(),e.qZA()}}function Q(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td"),e.TgZ(2,"a",16),e.NdJ("click",function(){const i=e.CHM(t).$implicit;return e.oxw(2).onDeviceDiagnostic(i)}),e._uU(3),e.qZA(),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e.TgZ(9,"a",16),e.NdJ("click",function(){const i=e.CHM(t).$implicit;return e.oxw(2).onDeviceFrequency(i)}),e._uU(10),e.qZA(),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.YNc(13,B,3,0,"td",17),e.qZA()}if(2&o){const t=c.$implicit,n=e.oxw(2);e.xp6(3),e.Oqu(t.device_id),e.xp6(2),e.Oqu(t.device_type_name),e.xp6(2),e.Oqu(t.status),e.xp6(3),e.Oqu(t.frequency),e.xp6(2),e.Oqu(null==t?null:t.sim_msisdn),e.xp6(1),e.Q6J("ngIf",!n.readonly)}}function $(o,c){if(1&o&&(e.ynx(0),e.YNc(1,Q,14,6,"tr",15),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.totalDevices)}}function R(o,c){1&o&&(e.ynx(0),e.TgZ(1,"tr"),e.TgZ(2,"div",20),e._uU(3,"No record found"),e.qZA(),e.qZA(),e.BQk())}let z=(()=>{class o{constructor(t,n,s,i,a){this.modal=t,this.modalRef=n,this.fb=s,this.apiService=i,this.toastrService=a,this.totalDevices=[],this.selectedDevices=[],this.title="Total Allocated Devices",this.loading=!1,this.readonly=!1,this.consumerId=0,this.data=null,this.totalDevices=[],this.device_frequency=new m.NI(null,[m.kI.required])}ngOnInit(){this.getConsumerDevices()}getConsumerDevices(){this.loading=!0,this.apiService.get(`${l.N.customerms}/consumer/consumer-hardware?consumer=${this.consumerId}`).subscribe(n=>{this.totalDevices=n.data.data,this.loading=!1},n=>{this.loading=!1,this.toastrService.error(n.error.message,"Error getting allocated devices",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}onDeviceFrequency(t){this.modal.open(J.p,{size:"sm",scrollable:!0}).componentInstance.data=t}onSelectDevices(t,n){console.log(t,n),t.selected?this.selectedDevices.push(t):this.selectedDevices.splice(n,1)}onDeviceAllocation(){const t=this.modal.open(x.P,{size:"md-lg",scrollable:!0});t.componentInstance.consumerId=this.consumerId,t.componentInstance.fromConsumer=!0,t.closed.subscribe(()=>{this.getConsumerDevices()})}onSubmit(){this.loading=!0;const t=`${l.N.customerms}/consumer/consumer-hardware`;let n={consumer:this.consumerId};this.selectedDevices.forEach(s=>{n.inventory=s.inventory,n.id=s.id}),this.apiService.patch(t,n).subscribe(s=>{this.toastrService.success(s.message,"Devices successfully deallocated",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3}),this.getConsumerDevices()},s=>{this.loading=!1,this.toastrService.error(s.error.message,"Error deallocating device",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}onDeallocateDevice(t){this.loading=!0,this.apiService.patch(`${l.N.customerms}/consumer/consumer-hardware`,{consumer:t.consumer,inventory:t.inventory,id:t.id}).subscribe(i=>{this.toastrService.success(i.message,"Devices successfully deallocated",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3}),this.getConsumerDevices()},i=>{this.loading=!1,this.toastrService.error(i.error.message,"Error deallocating device",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}onCloseModal(){this.modalRef.close()}onDeviceDiagnostic(t){const n=this.modal.open(L.G,{size:"md",scrollable:!0});n.componentInstance.title=t.device_type_name,n.componentInstance.deviceType=t.device_type_name,n.componentInstance.data=t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.FF),e.Y36(g.Kz),e.Y36(m.qu),e.Y36(Z.s),e.Y36(T._W))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-total-devices"]],decls:30,vars:7,consts:[[1,"modal-header","pt-8","pb-8"],[1,"modal-title","fs-18","fw-300"],["type","button","tabindex","-1",1,"close",3,"click"],["src","/assets/images/block-loader.gif","alt","Loading","width","150px","height","150px","style","position: absolute; top: 30%; left: 42%; z-index: 1;",4,"ngIf"],["fxLayout","row wrap",1,"modal-body","w-100-p",2,"position","relative","height","calc(100% - 44px)"],["fxFlex","100","fxLayout","row","fxLayoutAlign","end center",4,"ngIf"],[1,"table","mt-8"],[4,"ngIf"],["fxFlex","100",1,"form-group","text-center","mb-0"],[1,"btn","btn-default","btn-round",3,"click"],[1,"ri-close-line"],["src","/assets/images/block-loader.gif","alt","Loading","width","150px","height","150px",2,"position","absolute","top","30%","left","42%","z-index","1"],["fxFlex","100","fxLayout","row","fxLayoutAlign","end center"],[1,"btn","btn-success","btn-round",3,"click"],[1,"ri-add-line"],[4,"ngFor","ngForOf"],[1,"text-overflow",3,"click"],["class","d-flex justify-content-center","style","border: 0 !important;",4,"ngIf"],[1,"d-flex","justify-content-center",2,"border","0 !important"],[1,"btn","btn-primary","h-28","lh-16",3,"click"],[2,"margin-top","4px"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"h4",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.onCloseModal()}),e._uU(4,"\xd7"),e.qZA(),e.qZA(),e.YNc(5,Y,1,0,"img",3),e.TgZ(6,"div",4),e.YNc(7,E,5,0,"div",5),e.TgZ(8,"table",6),e.TgZ(9,"thead"),e.TgZ(10,"tr"),e.TgZ(11,"td"),e._uU(12,"Device ID"),e.qZA(),e.TgZ(13,"td"),e._uU(14,"Device Type"),e.qZA(),e.TgZ(15,"td"),e._uU(16,"Status"),e.qZA(),e.TgZ(17,"td"),e._uU(18,"Default Frequency"),e.qZA(),e.TgZ(19,"td"),e._uU(20,"MSISDN"),e.qZA(),e.YNc(21,k,2,0,"td",7),e.qZA(),e.qZA(),e.TgZ(22,"tbody"),e.YNc(23,$,2,1,"ng-container",7),e.YNc(24,R,4,0,"ng-container",7),e.qZA(),e.qZA(),e.TgZ(25,"div",8),e.TgZ(26,"button",9),e.NdJ("click",function(){return n.onCloseModal()}),e._UZ(27,"i",10),e.TgZ(28,"span"),e._uU(29),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(n.title),e.xp6(3),e.Q6J("ngIf",n.loading),e.xp6(2),e.Q6J("ngIf",!n.readonly),e.xp6(14),e.Q6J("ngIf",!n.readonly),e.xp6(2),e.Q6J("ngIf",n.totalDevices.length>0),e.xp6(1),e.Q6J("ngIf",0===n.totalDevices.length),e.xp6(5),e.Oqu(n.readonly?"Close":"Discard"))},directives:[d.O5,u.xw,u.yH,u.Wh,d.sg],styles:[".table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%]{background-color:#ececec}.table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{height:30px!important;padding:0 30px 0 4px!important;font-weight:700!important;font-size:12px!important;line-height:28px;position:relative;cursor:pointer;text-transform:uppercase}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%], .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px!important;border:1px solid #ececec!important;height:36px!important;vertical-align:middle}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none!important;width:24px!important;height:24px!important;line-height:16px!important}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover, .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{color:#000}.table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%]   .even[_ngcontent-%COMP%]{background-color:#f3f7f94d!important}"]}),o})();var H=r(405),W=r(5507);function j(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",19),e.TgZ(1,"button",20),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(),i=e.MAs(25);return s.scrollLeft(i)}),e._UZ(2,"i",21),e.qZA(),e.qZA()}}function X(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"div",22),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"div",23),e._uU(5),e.qZA(),e.qZA(),e.BQk()),2&o){const t=c.$implicit,n=c.last;e.xp6(1),e.ekj("mr-0",n),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.count)}}function G(o,c){if(1&o){const t=e.EpF();e.TgZ(0,"div",24),e.TgZ(1,"button",20),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(),i=e.MAs(25);return s.scrollRight(i)}),e._UZ(2,"i",25),e.qZA(),e.qZA()}}const K=[{path:"",component:(()=>{class o{constructor(t,n,s,i){this.apiService=t,this.toastrService=n,this.modal=s,this.permService=i,this.actions=new w.xQ,this.loading=!1,this.readonly=!1;const a=JSON.parse(JSON.stringify(b.config));this.config=new S.Xu(a),this.cardsInfo={total_consumers:2,active_consumers:2,inactive_consumers:0,usecase_assigned_devices:[]}}ngOnInit(){q.I2["consumer-status"]=U,this.checkPermission(),this.getConsumerCardsInfo()}checkPermission(){let t=this.permService.checkPermissions();this.readonly=!(t&&t.length>0&&t.includes("RW"))}scrollLeft(t){const i=[.001,.021,.136,.341,.341,.136,.021,.001];(0,C.F)(50).pipe((0,h.o)(a=>a<8),(0,v.b)(a=>t.scrollLeft-=228*i[a])).subscribe()}scrollRight(t){const i=[.001,.021,.136,.341,.341,.136,.021,.001];(0,C.F)(50).pipe((0,h.o)(a=>a<8),(0,v.b)(a=>t.scrollLeft+=228*i[a])).subscribe()}getConsumerCardsInfo(){this.actions.next({action:"loadingTrue"}),this.apiService.get(`${l.N.customerms}/consumer/consumer-and-device-count`).subscribe(n=>{this.actions.next({action:"loadingFalse"}),this.cardsInfo=n.data},n=>{this.actions.next({action:"loadingFalse"}),[401,2,3,11,151,153,18,300,301].includes(n.error.status)?this.toastrService.error(n.error.message,"Access Unauthorized",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3}):this.toastrService.error(n.error.message,"Getting error customer cards information",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}onTableSignals(t){"OpenForm"===t.type?this.onAddNew():"onEdit"===t.type?this.onAddNew(t.row):"onDetails"===t.type?this.onAddNew(t.row,!0):"onTotalDevices"===t.type?this.onTotalDevices(t.row):"onAllocateDevices"===t.type?this.onAllocateDevice(t.row):"onChangeStatus"===t.type&&this.onChangeConsStatus(t.row)}onAddNew(t,n=!1){const s=this.modal.open(F.m,{size:"sm-lg",scrollable:!0});if(t){s.componentInstance.title="Edit Consumer";const i=t.phone;t.phone=i?i.replace("+974",""):"",s.componentInstance.data=t}n&&(s.componentInstance.readonly=n,s.componentInstance.title="Consumer Details"),s.closed.subscribe(()=>{this.actions.next({action:"reload"}),this.getConsumerCardsInfo()})}onTotalDevices(t){const n=this.modal.open(z,{size:"md-lg",scrollable:!0});n.componentInstance.data=t,n.componentInstance.consumerId=t.id,n.componentInstance.readonly=this.readonly,n.closed.subscribe(()=>{this.getConsumerCardsInfo(),this.actions.next({action:"reload"})})}onAllocateDevice(t){const n=this.modal.open(x.P,{size:"md-lg",scrollable:!0});n.componentInstance.fromConsumer=!0,n.componentInstance.consumerId=t.id,n.closed.subscribe(()=>{this.getConsumerCardsInfo(),this.actions.next({action:"reload"})})}onDelete(t){const n=`${l.N.customerms}/consumer?id=${t.id}`;_.c.warn("Are you sure?","You want to delete this consumer","Yes").subscribe(s=>{s.positive&&this.apiService.delete(n).subscribe(i=>{this.toastrService.success(i.message,"Consumer deleted successfully",{progressAnimation:"decreasing",progressBar:!0,timeOut:3e3}),this.getConsumerCardsInfo(),this.actions.next({action:"reload"})},i=>{this.toastrService.error(i.error.message,"Error deleting consumer",{progressAnimation:"decreasing",progressBar:!0,timeOut:3e3})})})}onChangeConsStatus(t){let n=1===t.status?"InActive":"Active";const i=`${l.N.customerms}/consumer/?id=${t.id}&status=${"InActive"===n?2:1}`;_.c.warn("Are you sure?","You want to make this consumer "+n,"Yes").subscribe(a=>{a.positive&&(this.actions.next({action:"loadingTrue"}),this.apiService.delete(i).subscribe(p=>{this.toastrService.success(p.message,"Set consumer "+n,{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3}),this.getConsumerCardsInfo(),this.actions.next({action:"reload"})},p=>{this.actions.next({action:"loadingFalse"}),this.toastrService.error(p.error.message,"Error setting consumer status as"+n,{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})}))})}deleteCondition(t,n){let s=localStorage.getItem("user");return"SA"===JSON.parse(s).type}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Z.s),e.Y36(T._W),e.Y36(g.FF),e.Y36(H.$))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-consumer"]],decls:30,vars:8,consts:[[1,"card","w-100-p",2,"border","none","height","100%"],[1,"fs-14","fw-600","p-16","pt-10","pb-10","mb-0",2,"border-bottom","1px solid #ececec"],["ngbTooltip","Consumer Name, Email, Phone Number, Passport, Total Devices, Status, Actions","triggers","mouseenter:mouseleave","container","body","placement","top",1,"ri-information-line","info","grey-400"],["fxLayout","row wrap",1,"p-16","w-100-p",2,"height","calc(100% - 40px)"],["fxLayout","row","fxLayoutGap","4px",1,"h-56","mb-12","white","text-center","w-100-p"],["fxLayout","row","fxLayoutAlign","space-between center",1,"card","round","p-16","pt-0","pb-0","w-228",2,"background","#f60000","height","100%"],["src","./assets/images/icon-security-white.png","alt","","height","40"],["fxFlex","","fxLayout","column"],[1,"fs-20","fw-600"],[1,"mb-10"],[1,"fw-600"],["fxLayout","row","fxLayoutAlign","space-between start",1,"h-100-p","scrl-div"],["class","bttn-left",4,"ngIf"],["name","dv",1,"h-100-p","w-100-p","pl-16","pr-16",2,"overflow","hidden","display","-webkit-box !important"],["widget",""],[4,"ngFor","ngForOf"],["class","bttn-right",4,"ngIf"],[1,"w-100-p",2,"height","calc(100% - 68px)"],[3,"config","actions","signals"],[1,"bttn-left"],[1,"btn","btn-icon","btn-sm","btn-danger","btn-round","white","lh-18","h-28","w-28",2,"padding","4px",3,"click"],[1,"ri-arrow-left-s-line"],["fxLayout","column","fxLayoutAlign","center center",1,"bg-black-700","card","round","h-100-p","pl-8","pr-8","mr-8",2,"min-width","10%"],[1,"fs-20"],[1,"bttn-right"],[1,"ri-arrow-right-s-line"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"h3",1),e._uU(2,"Consumers "),e._UZ(3,"i",2),e.qZA(),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.TgZ(6,"div",5),e._UZ(7,"img",6),e.TgZ(8,"div",7),e.TgZ(9,"div"),e._uU(10,"Consumers"),e.qZA(),e.TgZ(11,"div",8),e._uU(12),e.qZA(),e.qZA(),e.TgZ(13,"div",7),e.TgZ(14,"div",9),e._uU(15,"Active: "),e.TgZ(16,"span",10),e._uU(17),e.qZA(),e.qZA(),e.TgZ(18,"div"),e._uU(19,"Inactive: "),e.TgZ(20,"span",10),e._uU(21),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",11),e.YNc(23,j,3,0,"div",12),e.TgZ(24,"div",13,14),e.YNc(26,X,6,4,"ng-container",15),e.qZA(),e.YNc(27,G,3,0,"div",16),e.qZA(),e.qZA(),e.TgZ(28,"div",17),e.TgZ(29,"general-table",18),e.NdJ("signals",function(i){return n.onTableSignals(i)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(12),e.Oqu(n.cardsInfo.total_consumers),e.xp6(5),e.Oqu(n.cardsInfo.active_consumers),e.xp6(4),e.Oqu(n.cardsInfo.inactive_consumers),e.xp6(2),e.Q6J("ngIf",n.cardsInfo.usecase_assigned_devices.length>6),e.xp6(3),e.Q6J("ngForOf",n.cardsInfo.usecase_assigned_devices),e.xp6(1),e.Q6J("ngIf",n.cardsInfo.usecase_assigned_devices.length>6),e.xp6(2),e.Q6J("config",n.config)("actions",n.actions))},directives:[g._L,u.xw,u.SQ,u.Wh,u.yH,d.O5,d.sg,W.b],styles:[".info[_ngcontent-%COMP%]{font-weight:400;margin-left:10px}.info[_ngcontent-%COMP%]:hover{text-decoration:underline}.scrl-div[_ngcontent-%COMP%]{width:calc(100% - 242px);position:relative;height:100%}.scrl-div[_ngcontent-%COMP%]   .bttn-left[_ngcontent-%COMP%]{position:absolute;left:0;top:25%;z-index:1;display:none}.scrl-div[_ngcontent-%COMP%]   .bttn-right[_ngcontent-%COMP%]{position:absolute;right:0;top:25%;z-index:1;display:none}.scrl-div[_ngcontent-%COMP%]:hover   .bttn-left[_ngcontent-%COMP%], .scrl-div[_ngcontent-%COMP%]:hover   .bttn-right[_ngcontent-%COMP%]{display:block;transition:all 2s ease-in}.even-row[_ngcontent-%COMP%]{background-color:#f3f7f94d!important}"]}),o})()}];let V=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[P.Bz.forChild(K)]]}),o})();var ee=r(3781);let te=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[d.ez,m.UX,m.u5,V,A.o9,g.IJ,y.A0,O.C,D.o,I.t,M.U,ee.CustomerModule]]}),o})()}}]);