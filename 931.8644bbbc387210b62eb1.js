"use strict";(self.webpackChunkprism_health_lab=self.webpackChunkprism_health_lab||[]).push([[931],{5931:(S,d,i)=>{i.d(d,{m:()=>w});var a=i(665),g=i(8763),u=i(107),_=i(2340),e=i(7716),p=i(3633),f=i(5830),h=i(9344),Z=i(8583),l=i(1819);function x(t,s){1&t&&e._UZ(0,"img",27)}function C(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please provide first name "),e.qZA())}function T(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," First name must be of less than 60 characters "),e.qZA())}function v(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Avoid white space "),e.qZA())}function F(t,s){if(1&t&&(e.ynx(0),e.YNc(1,C,2,0,"span",15),e.YNc(2,T,2,0,"span",15),e.YNc(3,v,2,0,"span",15),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.first_name.hasError("required")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.first_name.hasError("maxlength")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.first_name.hasError("whitespace"))}}function A(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please provide last name "),e.qZA())}function b(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Last name must be of 60 characters "),e.qZA())}function y(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Avoid white spaces "),e.qZA())}function I(t,s){if(1&t&&(e.ynx(0),e.YNc(1,A,2,0,"span",15),e.YNc(2,b,2,0,"span",15),e.YNc(3,y,2,0,"span",15),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.last_name.hasError("required")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.last_name.hasError("maxlength")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.last_name.hasError("whitespace"))}}function q(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please provide email "),e.qZA())}function E(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please provide valid email "),e.qZA())}function U(t,s){if(1&t&&(e.ynx(0),e.YNc(1,q,2,0,"span",15),e.YNc(2,E,2,0,"span",15),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.email.hasError("required")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.email.getError("pattern"))}}function N(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please provide passport / Q-ID "),e.qZA())}function J(t,s){1&t&&(e.TgZ(0,"div",8),e._uU(1," Please provide phone number "),e.qZA())}function Q(t,s){1&t&&(e.TgZ(0,"div",8),e._uU(1," Phone no must be of 8 digits "),e.qZA())}function D(t,s){1&t&&(e.TgZ(0,"div",8),e._uU(1," Phone no must be numeric "),e.qZA())}function P(t,s){if(1&t&&(e.ynx(0),e.YNc(1,J,2,0,"div",15),e.YNc(2,Q,2,0,"div",15),e.YNc(3,D,2,0,"div",15),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.phone.hasError("required")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.phone.hasError("minlength")),e.xp6(1),e.Q6J("ngIf",n.consumerForm.controls.phone.hasError("phoneonly"))}}function O(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please provide document name "),e.qZA())}function L(t,s){1&t&&(e.TgZ(0,"span",8),e._uU(1," Please upload document. "),e.qZA())}function M(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"label"),e._uU(2,"Upload File"),e.qZA(),e.TgZ(3,"span",8),e._uU(4," (Max 5MB/.jpg.png.pdf)"),e.qZA(),e.TgZ(5,"input",28,29),e.NdJ("change",function(r){return e.CHM(n),e.oxw().onImageChanged(r)}),e.qZA(),e.YNc(7,L,2,0,"span",15),e.qZA()}if(2&t){const n=e.oxw();e.xp6(7),e.Q6J("ngIf",n.consumerForm.controls.document_file.hasError("required")&&n.consumerForm.controls.document_file.touched)}}function Y(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"div",30),e.TgZ(1,"a",31),e.NdJ("click",function(){return e.CHM(n),e.oxw().onViewDoc()}),e._uU(2,"View Document"),e.qZA(),e.qZA()}}function k(t,s){if(1&t){const n=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){return e.CHM(n),e.oxw().onSubmit()}),e._UZ(1,"i",33),e.TgZ(2,"span"),e._uU(3),e.qZA(),e.qZA()}if(2&t){const n=e.oxw();e.Q6J("disabled",!n.consumerForm.valid||n.loading),e.xp6(3),e.Oqu(null!=n.data&&n.data.id?"Update":"Save")}}let w=(()=>{class t{constructor(n,o,r,m,c){this.modal=n,this.modalRef=o,this.fb=r,this.apiService=m,this.toastrService=c,this.fromInventory=!1,this.title="Add Consumer",this.imageLoading=!1,this.loading=!1,this.readonly=!1,this.consumerId=0,this.selectedImage=null,this.data=null,this.consumerForm=this.fb.group({id:[null],first_name:[null,[a.kI.required,a.kI.maxLength(60),u.d.noWhiteSpace]],last_name:[null,[a.kI.required,a.kI.maxLength(60),u.d.noWhiteSpace]],email:[null,[a.kI.required,a.kI.pattern("^[a-zA-Z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$")]],phone:[null,[a.kI.required,a.kI.minLength(8),u.d.phoneOnly]],document_file:[null],document_name:[null],qid_passport:[null]})}ngOnInit(){if(this.data){const n=this.data.phone.toString();n.includes("+974")&&(this.data.phone=n.replace("+974","")),this.consumerForm.patchValue(this.data)}this.fromInventory&&this.getConsumer()}getConsumer(){this.loading=!0,this.apiService.get(`${_.N.customerms}/consumer/?consumer=${this.consumerId}`).subscribe(o=>{this.loading=!1;let r=o.data.data[0];const m=r.phone;r.phone=m?m.replace("+974",""):"",this.consumerForm.patchValue(r)},o=>{this.loading=!1,this.toastrService.error(o.error.message,"Error getting details of consumer",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}chooseImage(){var n;null===(n=document.getElementById("fileInput"))||void 0===n||n.click()}onImageChanged(n){var o;let r;this.imageLoading=!0,r=n.target.files[0],null===(o=this.consumerForm.get("document_file"))||void 0===o||o.setValue(r),this.readImageURL(n.target)}readImageURL(n){if(n.files&&n.files[0]){var o=new FileReader;o.onload=r=>{this.selectedImage=null==r?void 0:r.target.result},this.imageLoading=!1,o.readAsDataURL(n.files[0])}}onViewDoc(){var n;this.modal.open(g.m,{size:"md",scrollable:!0}).componentInstance.imgSource=null===(n=this.data)||void 0===n?void 0:n.document_file}onSubmit(){this.loading=!0;const n=`${_.N.customerms}/consumer/`;let o=this.consumerForm.value;o.phone.toString().includes("+974")||(o.phone="+974"+o.phone);let m=o.document_file;(null==m||"string"==typeof m&&m.includes("https"))&&delete o.document_file;let c=this.convertToFormData(o);o.id?this.updateConsumer(n,c):this.createConsumer(n,c)}convertToFormData(n){let o=new FormData;for(let r in n)o.append(r,n[r]);return o}createConsumer(n,o){this.apiService.post(n,o).subscribe(r=>{this.loading=!1,this.toastrService.success(r.message,"Consumer successfully created",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3}),this.modalRef.close()},r=>{this.loading=!1,this.toastrService.error(r.error.message,"Error creating consumer",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}updateConsumer(n,o){this.apiService.patch(n,o).subscribe(r=>{this.loading=!1,this.toastrService.success(r.message,"Consumer successfully updated",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3}),this.modalRef.close()},r=>{this.loading=!1,this.toastrService.error(r.error.message,"Error updating consumer",{progressBar:!0,progressAnimation:"decreasing",timeOut:3e3})})}onCloseModal(){this.modalRef.close()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(p.FF),e.Y36(p.Kz),e.Y36(a.qu),e.Y36(f.s),e.Y36(h._W))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-consumer-form"]],decls:58,vars:19,consts:[[1,"modal-header","pt-8","pb-8"],[1,"modal-title","fs-18","fw-300"],["type","button","tabindex","-1",1,"close",3,"click"],["src","/assets/images/block-loader.gif","alt","Loading","width","150px","height","150px","style","position: absolute; top: 30%; left: 40%; z-index: 1;",4,"ngIf"],["fxLayout","row wrap",1,"modal-body","w-100-p",2,"position","relative"],["fxFlex","100","fxLayout","row wrap","fxLayoutGap","8px",3,"formGroup","ngSubmit"],["fxFlex","32.5",1,"form-group"],["for","fn"],[1,"text-danger"],["type","text","formControlName","first_name","required","","placeholder","Enter first name",1,"form-control",3,"readonly"],[4,"ngIf"],["type","text","formControlName","last_name","required","","placeholder","Enter last name",1,"form-control",3,"readonly"],["fxFlex","32.5",1,"form-group","mr-0"],["type","text","formControlName","email","required","","placeholder","Enter your email",1,"form-control",3,"readonly"],["type","text","formControlName","qid_passport","placeholder","Enter Q-ID or Passport",1,"form-control",3,"readonly"],["class","text-danger",4,"ngIf"],[1,"input-group"],["for","ph",1,"input-group-text",2,"border-right","none"],["type","text","autocomplete","off","id","ph","maxlength","8","formControlName","phone","placeholder","Phone Number",1,"form-control",3,"readonly"],["type","text","formControlName","document_name","placeholder","Enter document name",1,"form-control",3,"readonly"],["fxFlex","32.5","class","form-group",4,"ngIf"],["fxFlex","32.5","fxLayoutAlign","start center",4,"ngIf"],["fxFlex","100"],["fxFlex","100",1,"form-group","text-center","mb-0"],["type","submit","class","btn btn-success btn-round mr-8",3,"disabled","click",4,"ngIf"],[1,"btn","btn-default","btn-round",3,"click"],[1,"ri-close-line"],["src","/assets/images/block-loader.gif","alt","Loading","width","150px","height","150px",2,"position","absolute","top","30%","left","40%","z-index","1"],["id","fileInput","type","file",1,"form-control-file","btn","btn-default","h-36","lh-16",3,"change"],["file",""],["fxFlex","32.5","fxLayoutAlign","start center"],[1,"btn","btn-default","btn-link","mt-14","h-36",2,"border-radius","0",3,"click"],["type","submit",1,"btn","btn-success","btn-round","mr-8",3,"disabled","click"],[1,"ri-check-fill"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"h4",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return o.onCloseModal()}),e._uU(4,"\xd7"),e.qZA(),e.qZA(),e.YNc(5,x,1,0,"img",3),e.TgZ(6,"div",4),e.TgZ(7,"form",5),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(8,"div",6),e.TgZ(9,"label",7),e._uU(10,"First Name"),e.qZA(),e.TgZ(11,"span",8),e._uU(12,"*"),e.qZA(),e._UZ(13,"input",9),e.YNc(14,F,4,3,"ng-container",10),e.qZA(),e.TgZ(15,"div",6),e.TgZ(16,"label",7),e._uU(17,"Last Name"),e.qZA(),e.TgZ(18,"span",8),e._uU(19,"*"),e.qZA(),e._UZ(20,"input",11),e.YNc(21,I,4,3,"ng-container",10),e.qZA(),e.TgZ(22,"div",12),e.TgZ(23,"label",7),e._uU(24,"Email"),e.qZA(),e.TgZ(25,"span",8),e._uU(26,"*"),e.qZA(),e._UZ(27,"input",13),e.YNc(28,U,3,2,"ng-container",10),e.qZA(),e.TgZ(29,"div",6),e.TgZ(30,"label",7),e._uU(31,"Q-ID / Passport"),e.qZA(),e._UZ(32,"input",14),e.YNc(33,N,2,0,"span",15),e.qZA(),e.TgZ(34,"div",6),e.TgZ(35,"label"),e._uU(36,"Phone Number"),e.TgZ(37,"span",8),e._uU(38,"*"),e.qZA(),e.qZA(),e.TgZ(39,"div",16),e.TgZ(40,"span",17),e._uU(41,"+974"),e.qZA(),e._UZ(42,"input",18),e.qZA(),e.YNc(43,P,4,3,"ng-container",10),e.qZA(),e.TgZ(44,"div",12),e.TgZ(45,"label"),e._uU(46,"Document Name"),e.qZA(),e._UZ(47,"input",19),e.YNc(48,O,2,0,"span",15),e.qZA(),e.YNc(49,M,8,1,"div",20),e.YNc(50,Y,3,0,"div",21),e.qZA(),e._UZ(51,"hr",22),e.TgZ(52,"div",23),e.YNc(53,k,4,2,"button",24),e.TgZ(54,"button",25),e.NdJ("click",function(){return o.onCloseModal()}),e._UZ(55,"i",26),e.TgZ(56,"span"),e._uU(57),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(2),e.Oqu(o.title),e.xp6(3),e.Q6J("ngIf",o.loading),e.xp6(2),e.Q6J("formGroup",o.consumerForm),e.xp6(6),e.Q6J("readonly",o.readonly),e.xp6(1),e.Q6J("ngIf",o.consumerForm.controls.first_name.dirty),e.xp6(6),e.Q6J("readonly",o.readonly),e.xp6(1),e.Q6J("ngIf",o.consumerForm.controls.last_name.dirty),e.xp6(6),e.Q6J("readonly",o.readonly||(null==o.data?null:o.data.id)),e.xp6(1),e.Q6J("ngIf",o.consumerForm.controls.email.invalid&&o.consumerForm.controls.email.dirty),e.xp6(4),e.Q6J("readonly",o.readonly),e.xp6(1),e.Q6J("ngIf",o.consumerForm.controls.qid_passport.hasError("required")&&o.consumerForm.controls.qid_passport.dirty),e.xp6(9),e.Q6J("readonly",o.readonly),e.xp6(1),e.Q6J("ngIf",o.consumerForm.controls.phone.dirty),e.xp6(4),e.Q6J("readonly",o.readonly),e.xp6(1),e.Q6J("ngIf",o.consumerForm.controls.document_name.hasError("required")&&o.consumerForm.controls.document_name.touched),e.xp6(1),e.Q6J("ngIf",!o.readonly),e.xp6(1),e.Q6J("ngIf",o.readonly),e.xp6(3),e.Q6J("ngIf",!o.readonly),e.xp6(4),e.Oqu(o.readonly?"Close":"Discard"))},directives:[Z.O5,l.xw,a._Y,a.JL,l.yH,l.SQ,a.sg,a.Fj,a.JJ,a.u,a.Q7,a.nD,l.Wh],styles:[""]}),t})()}}]);